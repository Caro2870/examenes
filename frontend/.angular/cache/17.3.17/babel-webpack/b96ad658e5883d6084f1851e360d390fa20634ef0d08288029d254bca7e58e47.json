{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  http;\n  apiUrl = environment.apiUrl;\n  currentUserSubject = new BehaviorSubject(null);\n  currentUser$ = this.currentUserSubject.asObservable();\n  constructor(http) {\n    this.http = http;\n    const token = localStorage.getItem('token');\n    const user = localStorage.getItem('user');\n    if (token && user) {\n      this.currentUserSubject.next(JSON.parse(user));\n    }\n  }\n  get currentUserValue() {\n    return this.currentUserSubject.value;\n  }\n  login(email, password) {\n    return this.http.post(`${this.apiUrl}/auth/login`, {\n      email,\n      password\n    }).pipe(tap(response => {\n      localStorage.setItem('token', response.access_token);\n      localStorage.setItem('user', JSON.stringify(response.user));\n      this.currentUserSubject.next(response.user);\n    }));\n  }\n  register(email, password, nombre, apellido) {\n    return this.http.post(`${this.apiUrl}/auth/register`, {\n      email,\n      password,\n      nombre,\n      apellido\n    }).pipe(tap(response => {\n      localStorage.setItem('token', response.access_token);\n      localStorage.setItem('user', JSON.stringify(response.user));\n      this.currentUserSubject.next(response.user);\n    }));\n  }\n  logout() {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    this.currentUserSubject.next(null);\n  }\n  getToken() {\n    return localStorage.getItem('token');\n  }\n  isAuthenticated() {\n    return !!this.getToken();\n  }\n  refreshUser() {\n    return this.http.get(`${this.apiUrl}/users/me`).pipe(tap(user => {\n      localStorage.setItem('user', JSON.stringify(user));\n      this.currentUserSubject.next(user);\n    }));\n  }\n  static ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","tap","environment","AuthService","http","apiUrl","currentUserSubject","currentUser$","asObservable","constructor","token","localStorage","getItem","user","next","JSON","parse","currentUserValue","value","login","email","password","post","pipe","response","setItem","access_token","stringify","register","nombre","apellido","logout","removeItem","getToken","isAuthenticated","refreshUser","get","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["/app/src/app/core/services/auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\n\nexport interface User {\n  id: number;\n  email: string;\n  nombre: string;\n  apellido?: string;\n  role: string;\n  plan: string;\n}\n\nexport interface AuthResponse {\n  access_token: string;\n  user: User;\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AuthService {\n  private apiUrl = environment.apiUrl;\n  private currentUserSubject = new BehaviorSubject<User | null>(null);\n  public currentUser$ = this.currentUserSubject.asObservable();\n\n  constructor(private http: HttpClient) {\n    const token = localStorage.getItem('token');\n    const user = localStorage.getItem('user');\n    if (token && user) {\n      this.currentUserSubject.next(JSON.parse(user));\n    }\n  }\n\n  get currentUserValue(): User | null {\n    return this.currentUserSubject.value;\n  }\n\n  login(email: string, password: string): Observable<AuthResponse> {\n    return this.http.post<AuthResponse>(`${this.apiUrl}/auth/login`, { email, password }).pipe(\n      tap((response) => {\n        localStorage.setItem('token', response.access_token);\n        localStorage.setItem('user', JSON.stringify(response.user));\n        this.currentUserSubject.next(response.user);\n      }),\n    );\n  }\n\n  register(email: string, password: string, nombre: string, apellido?: string): Observable<AuthResponse> {\n    return this.http.post<AuthResponse>(`${this.apiUrl}/auth/register`, {\n      email,\n      password,\n      nombre,\n      apellido,\n    }).pipe(\n      tap((response) => {\n        localStorage.setItem('token', response.access_token);\n        localStorage.setItem('user', JSON.stringify(response.user));\n        this.currentUserSubject.next(response.user);\n      }),\n    );\n  }\n\n  logout(): void {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    this.currentUserSubject.next(null);\n  }\n\n  getToken(): string | null {\n    return localStorage.getItem('token');\n  }\n\n  isAuthenticated(): boolean {\n    return !!this.getToken();\n  }\n\n  refreshUser(): Observable<User> {\n    return this.http.get<User>(`${this.apiUrl}/users/me`).pipe(\n      tap((user) => {\n        localStorage.setItem('user', JSON.stringify(user));\n        this.currentUserSubject.next(user);\n      }),\n    );\n  }\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}